#!/usr/bin/bash
# Converts all .html files in a directory to RST files, preserving YAML headers
# Namely used for converting HTML Blogofile posts to RST
# Requires pandoc (available in most distros' repos)
# Written by David Gay (oddshocks), and released free and open-source
# Thanks to sublimepua for helping with sed

# ATTENTION: Keep your HTML files until you're sure the blog builds how you
# want it to. I had to fix quite a few files. Probably imperfect HTML files.

shopt -s nullglob
for f in *.html
do
    echo "Converting $f to RST"
    new_file_name=${f:0:${#f}-4}rst
    content=$(sed -n '/re/,$p' $f)
    diff -a <(cat $f) <(sed -n '/re/,$p' $f) | sed 's/<//' \
                            | sed -n '1!p' > $new_file_name
    # remove leading whitespace from file
    sed "s/^[ \t]*//" -i $new_file_name
    echo "" >> $new_file_name
    pandoc --from=html --to=rst <(sed -n '/re/,$p' $f) >> $new_file_name
done
